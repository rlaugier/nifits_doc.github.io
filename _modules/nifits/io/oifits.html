<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>nifits.io.oifits &mdash; NIFITS 0.0.3 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/fonts.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=65a4545c"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            NIFITS
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"></div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">NIFITS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">nifits.io.oifits</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for nifits.io.oifits</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A module for reading/writing NIFITS files and handling the data.</span>

<span class="sd">To open an existing NIFITS file, use ``nifits.from_nifits`` constructor.</span>

<span class="sd">To save an NIFITS object to a file, use ``nifits.to_nifits`` method.</span>

<span class="sd">A summary of the information in the oifits object can be obtained by</span>
<span class="sd">using the info() method:</span>

<span class="sd">   &gt; import oifits</span>
<span class="sd">   &gt; oifitsobj = oifits.open(&#39;foo.fits&#39;)</span>
<span class="sd">   &gt; oifitsobj.info()</span>

<span class="sd">For further information, contact R. Laugier</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="kn">import</span> <span class="n">EarthLocation</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">packaging</span> <span class="kn">import</span> <span class="n">version</span>

<span class="n">_mjdzero</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1858</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">17</span><span class="p">)</span>

<span class="n">matchtargetbyname</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">matchstationbyname</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">refdate</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_plurals</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">count</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="s1">&#39;s&#39;</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span>

<span class="k">def</span> <span class="nf">_array_eq</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="s2">&quot;Test whether all the elements of two arrays are equal.&quot;</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="n">a</span> <span class="o">!=</span> <span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="n">a</span> <span class="o">!=</span> <span class="n">b</span><span class="p">)</span>



<span class="k">def</span> <span class="nf">_isnone</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convenience hack for checking if x is none; needed because numpy</span>
<span class="sd">    arrays will, at some point, return arrays for x == None.&quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_notnone</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convenience hack for checking if x is not none; needed because numpy</span>
<span class="sd">    arrays will, at some point, return arrays for x != None.&quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>




<div class="viewcode-block" id="OI_STATION"><a class="viewcode-back" href="../../../nifits.io.html#nifits.io.oifits.OI_STATION">[docs]</a><span class="k">class</span> <span class="nc">OI_STATION</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; This class corresponds to a single row (i.e. single</span>
<span class="sd">    station/telescope) of an OI_ARRAY table.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tel_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sta_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">diameter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">staxyz</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">fov</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fovtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">revision</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">revision</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;OI_ARRAY revision </span><span class="si">%d</span><span class="s1"> not implemented yet&#39;</span><span class="o">%</span><span class="n">revision</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">revision</span> <span class="o">=</span> <span class="n">revision</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tel_name</span> <span class="o">=</span> <span class="n">tel_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sta_name</span> <span class="o">=</span> <span class="n">sta_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diameter</span> <span class="o">=</span> <span class="n">diameter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">staxyz</span> <span class="o">=</span> <span class="n">staxyz</span>

        <span class="k">if</span> <span class="n">revision</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fov</span> <span class="o">=</span> <span class="n">fov</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fovtype</span> <span class="o">=</span> <span class="n">fovtype</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fov</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fovtype</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">revision</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">revision</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tel_name</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">tel_name</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sta_name</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">sta_name</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">diameter</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">diameter</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="ow">not</span> <span class="n">_array_eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">staxyz</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">staxyz</span><span class="p">))</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fov</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">fov</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fovtype</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">fovtype</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">revision</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%g</span><span class="s1"> m, fov </span><span class="si">%g</span><span class="s1"> arcsec (</span><span class="si">%s</span><span class="s1">))&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sta_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tel_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">diameter</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fov</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fovtype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%g</span><span class="s1"> m)&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sta_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tel_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">diameter</span><span class="p">)</span></div>


        

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span> <span class="nn">numpy.typing</span> <span class="kn">import</span> <span class="n">ArrayLike</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">NI_CATM</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Contains the complex amplitude transfer matrix CATM of the instrument.</span>
<span class="sd">    The CATM is a complex matrix representing the transformation from the each</span>
<span class="sd">    of the complex amplitude of electric field from the inputs to the outputs </span>
<span class="sd">    of the instrument. The dimensions are (n_ch, n_out, n_in) where n_ch </span>
<span class="sd">    represents the spectral channels.</span>
<span class="sd">    </span>
<span class="sd">    It is expected that</span>
<span class="sd">    $\textbf{n}_{out} = \textbf{M}_{CATM}.\textbf{m}_{mod} \circ \textbf{x}_{in}$</span>
<span class="sd">    with $\textbf{m}_{mod}$ containded in NI_MOD.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Mcatm</span><span class="p">:</span> <span class="n">ArrayLike</span>
    <span class="n">header</span><span class="p">:</span> <span class="n">fits</span><span class="o">.</span><span class="n">Header</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_hdu</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">hdu</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">ImageHDU</span><span class="p">)):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create the NI_CATM object from the HDU extension of an opened fits file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Mcatm</span> <span class="o">=</span> <span class="n">hdu</span><span class="o">.</span><span class="n">data</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">hdu</span><span class="o">.</span><span class="n">header</span>
        <span class="n">myobj</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">Mcatm</span><span class="p">,</span> <span class="n">header</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">myobj</span>

    <span class="k">def</span> <span class="nf">to_hdu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns and hdu object to save into fits</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">myhdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">ImageHDU</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Mcatm</span><span class="p">)</span>
        <span class="n">myhdu</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span>
        <span class="k">return</span> <span class="n">myhdu</span>
    <span class="c1"># TODO add a check method</span>


<div class="viewcode-block" id="nulfunc"><a class="viewcode-back" href="../../../nifits.io.html#nifits.io.oifits.nulfunc">[docs]</a><span class="k">def</span> <span class="nf">nulfunc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span></div>


<span class="n">NI_OUT_DEFAULT_HEADER</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Header</span><span class="p">(</span><span class="n">cards</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;UNITS&quot;</span><span class="p">,</span> <span class="s2">&quot;ADU&quot;</span><span class="p">,</span> <span class="s2">&quot;The units for output values&quot;</span><span class="p">)])</span>

<span class="n">NI_MOD_DEFAULT_HEADER</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Header</span><span class="p">(</span><span class="n">cards</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;MOD_PHAS_UNITS&quot;</span><span class="p">,</span> <span class="s2">&quot;rad&quot;</span><span class="p">,</span> <span class="s2">&quot;The units for modulation phasors&quot;</span><span class="p">),</span>
                                        <span class="p">(</span><span class="s2">&quot;ARRCOL_UNITS&quot;</span><span class="p">,</span> <span class="s2">&quot;m^2&quot;</span><span class="p">,</span> <span class="s2">&quot;The units for collecting area&quot;</span><span class="p">)</span>
                                            <span class="p">])</span>

<span class="c1"># Possible to use &quot;chromatic_gaussian_radial&quot;, &quot;diameter_gaussian_radial&quot;.</span>
<span class="c1"># Simplest default is a gaussian with r0 = lambda/D</span>
<span class="n">NI_FOV_DEFAULT_HEADER</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Header</span><span class="p">(</span><span class="n">cards</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;FOV_MODE&quot;</span><span class="p">,</span><span class="s2">&quot;diameter_gaussian_radial&quot;</span><span class="p">,</span><span class="s2">&quot;Type of FOV definition&quot;</span><span class="p">),</span>
                                        <span class="p">(</span><span class="s2">&quot;FOV_offset&quot;</span><span class="p">),</span>
                                        <span class="p">(</span><span class="s2">&quot;FOV_TELDIAM&quot;</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="s2">&quot;diameter of a collecting aperture for FOV&quot;</span><span class="p">),</span>
                                        <span class="p">(</span><span class="s2">&quot;FOV_TELDIAM_UNIT&quot;</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                                        <span class="p">(</span><span class="s2">&quot;WL_SHIFT_MODE&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)])</span>

    

<div class="viewcode-block" id="NI_EXTENSION"><a class="viewcode-back" href="../../../nifits.io.html#nifits.io.oifits.NI_EXTENSION">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">NI_EXTENSION</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ``NI_EXTENSION`` Generic class for NIFITS extensions</span>

<span class="sd">    **Inherited methods:**</span>

<span class="sd">    * ``from_hdu``: Creates the object from an ``astropy.io.fits.TableHDU`` object</span>
<span class="sd">    * ``to_hdu``  : Returns the ``TableHDU`` from itself.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_table</span><span class="p">:</span> <span class="n">Table</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">Table</span><span class="p">)</span>
    <span class="n">header</span><span class="p">:</span> <span class="n">fits</span><span class="o">.</span><span class="n">Header</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">fits</span><span class="o">.</span><span class="n">Header</span><span class="p">)</span>
    <span class="c1"># TODO: Potentially, this should be a None by default, while still being a </span>
    <span class="c1"># fits.Header type hint... We can if we have a None, we can catch it with </span>
    <span class="c1"># a __post_init__ method. TODO this will help cleanup the signature in the doc.</span>

<div class="viewcode-block" id="NI_EXTENSION.from_hdu"><a class="viewcode-back" href="../../../nifits.io.html#nifits.io.oifits.NI_EXTENSION.from_hdu">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_hdu</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">hdu</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">TableHDU</span><span class="p">)):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create the data object from the HDU extension of an opened fits file.</span>
<span class="sd">        </span>
<span class="sd">        **Arguments:**</span>
<span class="sd">        * hdu   : TableHDU object containing the relevant data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">hdu</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">hdu</span><span class="o">.</span><span class="n">header</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">data_table</span><span class="o">=</span><span class="n">data_table</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">)</span></div>

<div class="viewcode-block" id="NI_EXTENSION.to_hdu"><a class="viewcode-back" href="../../../nifits.io.html#nifits.io.oifits.NI_EXTENSION.to_hdu">[docs]</a>    <span class="k">def</span> <span class="nf">to_hdu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns and hdu object to save into fits</span>
<span class="sd">        </span>
<span class="sd">        **Note**: this also updates the header if dimension changes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO this looks like a bug in astropy.fits: the header should update on its own.</span>
        <span class="n">myhdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">BinTableHDU</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_table</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>
        <span class="c1"># myhdu = fits.hdu.BinTableHDU(name=self.name, data=self.data_table)</span>
        
        
        <span class="c1"># TODO: fix the diffing?</span>
        <span class="c1"># print(&quot;Updating header:\n&quot;, fits.HeaderDiff(myhdu.header, self.header).__repr__)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">myhdu</span><span class="o">.</span><span class="n">header</span>
        <span class="k">return</span> <span class="n">myhdu</span></div>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_table</span><span class="p">)</span></div>

<div class="viewcode-block" id="NI_EXTENSION_ARRAY"><a class="viewcode-back" href="../../../nifits.io.html#nifits.io.oifits.NI_EXTENSION_ARRAY">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">NI_EXTENSION_ARRAY</span><span class="p">(</span><span class="n">NI_EXTENSION</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generic class for NIFITS array extensions</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_array</span><span class="p">:</span> <span class="n">ArrayLike</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
    <span class="n">header</span><span class="p">:</span> <span class="n">fits</span><span class="o">.</span><span class="n">Header</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">fits</span><span class="o">.</span><span class="n">Header</span><span class="p">)</span>

<div class="viewcode-block" id="NI_EXTENSION_ARRAY.from_hdu"><a class="viewcode-back" href="../../../nifits.io.html#nifits.io.oifits.NI_EXTENSION_ARRAY.from_hdu">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_hdu</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">hdu</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">ImageHDU</span><span class="p">)):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create the data object from the HDU extension of an opened fits file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_array</span> <span class="o">=</span> <span class="n">hdu</span><span class="o">.</span><span class="n">data</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">hdu</span><span class="o">.</span><span class="n">header</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">data_array</span><span class="o">=</span><span class="n">data_array</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="NI_EXTENSION_ARRAY.to_hdu"><a class="viewcode-back" href="../../../nifits.io.html#nifits.io.oifits.NI_EXTENSION_ARRAY.to_hdu">[docs]</a>    <span class="k">def</span> <span class="nf">to_hdu</span><span class="p">(</span><span class="bp">self</span><span class="p">,):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns and hdu object to save into fits</span>
<span class="sd">        </span>
<span class="sd">        **Note**: this also updates the header if dimension changes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">myhdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">ImageHDU</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_array</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Updating header:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">HeaderDiff</span><span class="p">(</span><span class="n">myhdu</span><span class="o">.</span><span class="n">header</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">myhdu</span><span class="o">.</span><span class="n">header</span>
        <span class="k">return</span> <span class="n">myhdu</span></div>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="NI_EXTENSION_CPX_ARRAY"><a class="viewcode-back" href="../../../nifits.io.html#nifits.io.oifits.NI_EXTENSION_CPX_ARRAY">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">NI_EXTENSION_CPX_ARRAY</span><span class="p">(</span><span class="n">NI_EXTENSION</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generic class for NIFITS array extensions.</span>

<span class="sd">    The array is kept locally as complex valued, but it is</span>
<span class="sd">    stored to and loaded from a real-valued array with an</span>
<span class="sd">    extra first dimension of length 2 for (real, imaginary) parts.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_array</span><span class="p">:</span> <span class="n">ArrayLike</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
    <span class="n">header</span><span class="p">:</span> <span class="n">fits</span><span class="o">.</span><span class="n">Header</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">fits</span><span class="o">.</span><span class="n">Header</span><span class="p">)</span>

<div class="viewcode-block" id="NI_EXTENSION_CPX_ARRAY.from_hdu"><a class="viewcode-back" href="../../../nifits.io.html#nifits.io.oifits.NI_EXTENSION_CPX_ARRAY.from_hdu">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_hdu</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">hdu</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">ImageHDU</span><span class="p">)):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create the data object from the HDU extension of an opened fits file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">hdu</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span>\
                <span class="sa">f</span><span class="s2">&quot;Data should have 2 layers for real and imag. </span><span class="si">{</span><span class="n">hdu</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">data_array</span> <span class="o">=</span> <span class="n">hdu</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">hdu</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">hdu</span><span class="o">.</span><span class="n">header</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">data_array</span><span class="o">=</span><span class="n">data_array</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="NI_EXTENSION_CPX_ARRAY.to_hdu"><a class="viewcode-back" href="../../../nifits.io.html#nifits.io.oifits.NI_EXTENSION_CPX_ARRAY.to_hdu">[docs]</a>    <span class="k">def</span> <span class="nf">to_hdu</span><span class="p">(</span><span class="bp">self</span><span class="p">,):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns and hdu object to save into fits</span>
<span class="sd">        </span>
<span class="sd">        **Note**: this also updates the header if dimension changes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">real_valued_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">data_array</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">data_array</span><span class="o">.</span><span class="n">imag</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">myhdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">ImageHDU</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">real_valued_data</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Updating header:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">HeaderDiff</span><span class="p">(</span><span class="n">myhdu</span><span class="o">.</span><span class="n">header</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">myhdu</span><span class="o">.</span><span class="n">header</span>
        <span class="k">return</span> <span class="n">myhdu</span></div>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="OI_ARRAY"><a class="viewcode-back" href="../../../nifits.io.html#nifits.io.oifits.OI_ARRAY">[docs]</a><span class="k">class</span> <span class="nc">OI_ARRAY</span><span class="p">(</span><span class="n">NI_EXTENSION</span><span class="p">):</span>
    <span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    ``OI_ARRAY`` definition</span>
<span class="s2">    &quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">NI_EXTENSION</span><span class="o">.</span><span class="vm">__doc__</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;OI_ARRAY&quot;</span></div>

<span class="kn">from</span> <span class="nn">astropy.constants</span> <span class="kn">import</span> <span class="n">c</span> <span class="k">as</span> <span class="n">cst_c</span>

<div class="viewcode-block" id="OI_WAVELENGTH"><a class="viewcode-back" href="../../../nifits.io.html#nifits.io.oifits.OI_WAVELENGTH">[docs]</a><span class="k">class</span> <span class="nc">OI_WAVELENGTH</span><span class="p">(</span><span class="n">NI_EXTENSION</span><span class="p">):</span>
    <span class="n">__doc_</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    An object storing the OI_WAVELENGTH information, in compatibility with OIFITS practices.</span>

<span class="s2">    ** Shorthands:**</span>

<span class="s2">    * ``self.lambs`` : ``ArrayLike`` [m] returns an array containing the center of each</span>
<span class="s2">      spectral channel.</span>
<span class="s2">    * ``self.dlmabs`` : ``ArrayLike`` [m] an array containing the spectral bin widths.</span>
<span class="s2">    * ``self.nus`` : ``ArrayLike`` [Hz] an array containing central frequencies of the</span>
<span class="s2">      spectral channels.</span>
<span class="s2">    * ``self.dnus`` : ``ArrayLike`` [Hz] an array containing the frequency bin widths.</span>

<span class="s2">    &quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">NI_EXTENSION</span><span class="o">.</span><span class="vm">__doc__</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;OI_WAVELENGTH&quot;</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">lambs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_table</span><span class="p">[</span><span class="s2">&quot;EFF_WAVE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dlambs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_table</span><span class="p">[</span><span class="s2">&quot;EFF_BAND&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cst_c</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">lambs</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dnus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cst_c</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">dlambs</span></div>
        

<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">field</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>


<div class="viewcode-block" id="OI_TARGET"><a class="viewcode-back" href="../../../nifits.io.html#nifits.io.oifits.OI_TARGET">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">OI_TARGET</span><span class="p">(</span><span class="n">NI_EXTENSION</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ``OI_TARGET`` definition.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># target: List[str] = field(default_factory=list)</span>
    <span class="c1"># raep0: float = 0.</span>
    <span class="c1"># decep0: float = 0.</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;OI_TARGET&quot;</span>
<div class="viewcode-block" id="OI_TARGET.from_scratch"><a class="viewcode-back" href="../../../nifits.io.html#nifits.io.oifits.OI_TARGET.from_scratch">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_scratch</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the OI_TARGET object with an empty table.</span>

<span class="sd">        **Returns:**</span>
<span class="sd">        </span>
<span class="sd">        * ``OI_TARGET`` object with an empty table.</span>

<span class="sd">        Use ``add_target()`` to finish the job.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;TARGET_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;TARGET&quot;</span><span class="p">,</span> <span class="s2">&quot;RAEP0&quot;</span><span class="p">,</span> <span class="s2">&quot;DECEP0&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;EQUINOX&quot;</span><span class="p">,</span> <span class="s2">&quot;RA_ERR&quot;</span><span class="p">,</span> <span class="s2">&quot;DEC_ERR&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;SYSVEL&quot;</span><span class="p">,</span> <span class="s2">&quot;VELTYP&quot;</span><span class="p">,</span> <span class="s2">&quot;VELDEF&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;PMRA&quot;</span><span class="p">,</span> <span class="s2">&quot;PMDEC&quot;</span><span class="p">,</span> <span class="s2">&quot;PMRA_ERR&quot;</span><span class="p">,</span> <span class="s2">&quot;PMDEC_ERR&quot;</span><span class="p">,</span> 
                                    <span class="s2">&quot;PARALLAX&quot;</span><span class="p">,</span> <span class="s2">&quot;PARA_ERR&quot;</span><span class="p">,</span> <span class="s2">&quot;SPECTYP&quot;</span><span class="p">,</span> <span class="s2">&quot;CATEGORY&quot;</span> <span class="p">],</span>
                            <span class="n">dtype</span><span class="o">=</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span>
                                    <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span>
                                    <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span>
                                    <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> 
                                    <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="p">],)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">data_table</span><span class="o">=</span><span class="n">data_table</span><span class="p">)</span></div>
<div class="viewcode-block" id="OI_TARGET.add_target"><a class="viewcode-back" href="../../../nifits.io.html#nifits.io.oifits.OI_TARGET.add_target">[docs]</a>    <span class="k">def</span> <span class="nf">add_target</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;MyTarget&quot;</span><span class="p">,</span> <span class="n">raep0</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">decep0</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
                        <span class="n">equinox</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">ra_err</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">dec_err</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
                        <span class="n">sysvel</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">veltyp</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">veldef</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                        <span class="n">pmra</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">pmdec</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">pmra_err</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">pmdec_err</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> 
                        <span class="n">parallax</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">para_err</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">spectyp</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;&quot;</span> <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Use this method to add a row to the table of targets</span>
<span class="sd">        **Arguments:**</span>
<span class="sd">        </span>
<span class="sd">        * ``target_id``  : (default: 0)</span>
<span class="sd">        * ``target``     : (default: &quot;MyTarget&quot;)</span>
<span class="sd">        * ``raep0``      : (default: 0.)</span>
<span class="sd">        * ``decep0``     : (default: 0.)</span>
<span class="sd">        * ``equinox``    : (default: 0.)</span>
<span class="sd">        * ``ra_err``     : (default: 0.)</span>
<span class="sd">        * ``dec_err``    : (default: 0.)</span>
<span class="sd">        * ``sysvel``     : (default: 0.)</span>
<span class="sd">        * ``veltyp``     : (default: &quot;&quot;)</span>
<span class="sd">        * ``veldef``     : (default: &quot;&quot;)</span>
<span class="sd">        * ``pmra``       : (default: 0.)</span>
<span class="sd">        * ``pmdec``      : (default: 0.)</span>
<span class="sd">        * ``pmra_err``   : (default: 0.)</span>
<span class="sd">        * ``pmdec_err``  : (default: 0.)</span>
<span class="sd">        * ``parallax``   : (default: 0.)</span>
<span class="sd">        * ``para_err``   : (default: 0.)</span>
<span class="sd">        * ``spectyp``    : (default: &quot;&quot;)</span>
<span class="sd">        * ``category``   : (default: &quot;&quot;)</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">vals</span><span class="o">=</span><span class="p">[</span><span class="n">target_id</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">raep0</span><span class="p">,</span> <span class="n">decep0</span><span class="p">,</span>
                                    <span class="n">equinox</span><span class="p">,</span> <span class="n">ra_err</span><span class="p">,</span> <span class="n">dec_err</span><span class="p">,</span>
                                    <span class="n">sysvel</span><span class="p">,</span> <span class="n">veltyp</span><span class="p">,</span> <span class="n">veldef</span><span class="p">,</span>
                                    <span class="n">pmra</span><span class="p">,</span> <span class="n">pmdec</span><span class="p">,</span> <span class="n">pmra_err</span><span class="p">,</span> <span class="n">pmdec_err</span><span class="p">,</span> 
                                    <span class="n">parallax</span><span class="p">,</span> <span class="n">para_err</span><span class="p">,</span> <span class="n">spectyp</span><span class="p">,</span> <span class="n">category</span> <span class="p">])</span></div></div>

        
    
<div class="viewcode-block" id="NI_OUT"><a class="viewcode-back" href="../../../nifits.io.html#nifits.io.oifits.NI_OUT">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">NI_OUT</span><span class="p">(</span><span class="n">NI_EXTENSION</span><span class="p">):</span>
    <span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Contains measured intensities of the outputs of the instrument. </span>
<span class="s2">    Dimensions are (n_ch, n_out).&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">NI_EXTENSION</span><span class="o">.</span><span class="vm">__doc__</span>
    <span class="n">value_out</span><span class="p">:</span> <span class="n">Table</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">Table</span><span class="p">)</span>
    <span class="n">header</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">fits</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;NI_OUT&quot;</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">asarray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="n">np</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">module</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_value</span><span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">])</span>

<div class="viewcode-block" id="NI_OUT.check_against_catm"><a class="viewcode-back" href="../../../nifits.io.html#nifits.io.oifits.NI_OUT.check_against_catm">[docs]</a>    <span class="k">def</span> <span class="nf">check_against_catm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">catm</span><span class="p">:</span> <span class="n">NI_CATM</span><span class="p">):</span>
        <span class="n">n_wl</span> <span class="o">=</span> <span class="n">catm</span><span class="o">.</span><span class="n">Mcatm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># n_inputs = catm.Mcatm.shape[2] # Not needed</span>
        <span class="n">n_outputs</span> <span class="o">=</span> <span class="n">catm</span><span class="o">.</span><span class="n">Mcatm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">arow</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_value</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">arow</span><span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">n_wl</span><span class="p">,</span>\
                            <span class="sa">f</span><span class="s2">&quot;Inconsistent wavelength number in table </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">assert</span> <span class="n">arow</span><span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">n_outputs</span><span class="p">,</span>\
                            <span class="sa">f</span><span class="s2">&quot;Inconsistent outputs number in table at row </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_output</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">n_outputs</span><span class="p">,</span> <span class="s2">&quot;Inconsistent output number in array&quot;</span></div></div>

<div class="viewcode-block" id="NI_CATM"><a class="viewcode-back" href="../../../nifits.io.html#nifits.io.oifits.NI_CATM">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">NI_CATM</span><span class="p">(</span><span class="n">NI_EXTENSION_CPX_ARRAY</span><span class="p">):</span>
    <span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    The complex amplitude transfre function</span>
<span class="s2">    &quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">NI_EXTENSION_CPX_ARRAY</span><span class="o">.</span><span class="vm">__doc__</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;NI_CATM&quot;</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">M</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_array</span></div>

<div class="viewcode-block" id="NI_IOUT"><a class="viewcode-back" href="../../../nifits.io.html#nifits.io.oifits.NI_IOUT">[docs]</a><span class="k">class</span> <span class="nc">NI_IOUT</span><span class="p">(</span><span class="n">NI_EXTENSION</span><span class="p">):</span>
    <span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    ``NI_IOUT`` : a recording of the output values, given in intensity,</span>
<span class="s2">    flux, counts or arbitrary units.</span>
<span class="s2">    &quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">NI_EXTENSION</span><span class="o">.</span><span class="vm">__doc__</span></div>

<div class="viewcode-block" id="NI_KIOUT"><a class="viewcode-back" href="../../../nifits.io.html#nifits.io.oifits.NI_KIOUT">[docs]</a><span class="k">class</span> <span class="nc">NI_KIOUT</span><span class="p">(</span><span class="n">NI_EXTENSION</span><span class="p">):</span>
    <span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    ``NI_KIOUT`` : a recording of the processed output values using the</span>
<span class="s2">    the post-processing matrix given by ``NI_KMAT``. Typically differential</span>
<span class="s2">    null or kernel-null.</span>
<span class="s2">    &quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">NI_EXTENSION</span><span class="o">.</span><span class="vm">__doc__</span></div>

<div class="viewcode-block" id="NI_KCOV"><a class="viewcode-back" href="../../../nifits.io.html#nifits.io.oifits.NI_KCOV">[docs]</a><span class="k">class</span> <span class="nc">NI_KCOV</span><span class="p">(</span><span class="n">NI_EXTENSION_ARRAY</span><span class="p">):</span>
    <span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    The covariance matrix for the processed data contained in KIOUT.</span>
<span class="s2">    &quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">NI_EXTENSION_ARRAY</span><span class="o">.</span><span class="vm">__doc__</span></div>
    
<div class="viewcode-block" id="NI_KMAT"><a class="viewcode-back" href="../../../nifits.io.html#nifits.io.oifits.NI_KMAT">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">NI_KMAT</span><span class="p">(</span><span class="n">NI_EXTENSION_ARRAY</span><span class="p">):</span>
    <span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    The kernel matrix that defines the post-processing operation between outputs.</span>
<span class="s2">    The linear combination is defined by a real-valued matrix.</span>
<span class="s2">    &quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">NI_EXTENSION_ARRAY</span><span class="o">.</span><span class="vm">__doc__</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;NI_KMAT&quot;</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">K</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_array</span></div>

<div class="viewcode-block" id="NI_KOUT"><a class="viewcode-back" href="../../../nifits.io.html#nifits.io.oifits.NI_KOUT">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">NI_KOUT</span><span class="p">(</span><span class="n">NI_EXTENSION</span><span class="p">):</span>
    <span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    Differential output observations</span>
<span class="s2">    &quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">NI_EXTENSION</span><span class="o">.</span><span class="vm">__doc__</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;NI_KOUT&quot;</span></div>

<div class="viewcode-block" id="NI_MOD"><a class="viewcode-back" href="../../../nifits.io.html#nifits.io.oifits.NI_MOD">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">NI_MOD</span><span class="p">(</span><span class="n">NI_EXTENSION</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Contains input modulation vector for the given observation. The format</span>
<span class="sd">    is a complex phasor representing the alteration applied by the instrument</span>
<span class="sd">    to the light at its inputs. Either an intended modulation, or an estimated</span>
<span class="sd">    instrumental error. the dimenstions are (n_ch, n_in)</span>
<span class="sd">    </span>
<span class="sd">    The effects modeled in NI_MOD must cumulate with some that may be modeled</span>
<span class="sd">    in NI_CATM. It is recommended to include in CATM the static effects and in</span>
<span class="sd">    NI_MOD any affect that may vary throughout the observng run.</span>


<span class="sd">    :math:`n_a \times \lambda`</span>

<span class="sd">    </span>
<span class="sd">    .. table:: ``NI_MOD``: The table of time-dependent collectorwise</span>
<span class="sd">    information.</span>

<span class="sd">       +---------------+----------------------------+------------------+-------------------+</span>
<span class="sd">       | Item          | format                     | unit             | comment           |</span>
<span class="sd">       +===============+============================+==================+===================+</span>
<span class="sd">       | ``APP_INDEX`` |  ``int``                   | NA               | Indices of        |</span>
<span class="sd">       |               |                            |                  | subaperture       |</span>
<span class="sd">       |               |                            |                  | (starts at 0)     |</span>
<span class="sd">       +---------------+----------------------------+------------------+-------------------+</span>
<span class="sd">       | ``TARGET_ID`` |  ``int``                   | d                | Index of target   |</span>
<span class="sd">       |               |                            |                  | in ``OI_TARGET``  |</span>
<span class="sd">       +---------------+----------------------------+------------------+-------------------+</span>
<span class="sd">       | ``TIME``      | ``float``                  | s                | Backwards         |</span>
<span class="sd">       |               |                            |                  | compatibility     |</span>
<span class="sd">       +---------------+----------------------------+------------------+-------------------+</span>
<span class="sd">       | ``MJD``       | ``float``                  | day              |                   |</span>
<span class="sd">       +---------------+----------------------------+------------------+-------------------+</span>
<span class="sd">       | ``INT_TIME``  | ``float``                  | s                | Exposure time     |</span>
<span class="sd">       +---------------+----------------------------+------------------+-------------------+</span>
<span class="sd">       | ``MOD_PHAS``  | ``n_{wl},n_a`` ``float``   |                  | Complex phasor of |</span>
<span class="sd">       |               |                            |                  | modulation for    |</span>
<span class="sd">       |               |                            |                  | all collectors    |</span>
<span class="sd">       +---------------+----------------------------+------------------+-------------------+</span>
<span class="sd">       | ``APPXY``     | ``n_a,2`` ``float``        | m                | Projected         |</span>
<span class="sd">       |               |                            |                  | location of       |</span>
<span class="sd">       |               |                            |                  | subapertures in   |</span>
<span class="sd">       |               |                            |                  | the plane         |</span>
<span class="sd">       |               |                            |                  | orthogonal to the |</span>
<span class="sd">       |               |                            |                  | line of sight and |</span>
<span class="sd">       |               |                            |                  | oriented as       |</span>
<span class="sd">       |               |                            |                  | ``(               |</span>
<span class="sd">       |               |                            |                  | \alpha, \delta)`` |</span>
<span class="sd">       +---------------+----------------------------+------------------+-------------------+</span>
<span class="sd">       | ``ARRCOL``    | ``n_a`` ``float``          | ``\mathrm{m}^2`` | Collecting area   |</span>
<span class="sd">       |               |                            |                  | of the            |</span>
<span class="sd">       |               |                            |                  | subaperture       |</span>
<span class="sd">       +---------------+----------------------------+------------------+-------------------+</span>
<span class="sd">       | ``FOV_INDEX`` | ``n_a`` ``int``            | NA               | The entry of the  |</span>
<span class="sd">       |               |                            |                  | ``NI_FOV`` to use |</span>
<span class="sd">       |               |                            |                  | for this          |</span>
<span class="sd">       |               |                            |                  | subaperture.      |</span>
<span class="sd">       +---------------+----------------------------+------------------+-------------------+</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data_table</span><span class="p">:</span> <span class="n">Table</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">Table</span><span class="p">)</span>
    <span class="n">header</span><span class="p">:</span> <span class="n">fits</span><span class="o">.</span><span class="n">Header</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">fits</span><span class="o">.</span><span class="n">Header</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;NI_MOD&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">n_series</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_table</span><span class="p">)</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">all_phasors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_table</span><span class="p">[</span><span class="s2">&quot;MOD_PHAS&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">appxy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Shape n_frames x n_a x 2&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_table</span><span class="p">[</span><span class="s2">&quot;APPXY&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dateobs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the dateobs from the weighted mean of the observation time</span>
<span class="sd">        from each of the observation times given in the rows of ``NI_MOD``</span>
<span class="sd">        table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dateobs</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">arrcol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The collecting area of the telescopes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_table</span><span class="p">[</span><span class="s2">&quot;ARRCOL&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">int_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Conveniently retrieve the integration time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_table</span><span class="p">[</span><span class="s2">&quot;INT_TIME&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span></div>
        
        
        
<div class="viewcode-block" id="create_basic_fov_data"><a class="viewcode-back" href="../../../nifits.io.html#nifits.io.oifits.create_basic_fov_data">[docs]</a><span class="k">def</span> <span class="nf">create_basic_fov_data</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">lamb</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A convenience function to help define the FOV function and data model</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r_0</span> <span class="o">=</span> <span class="p">(</span><span class="n">lamb</span><span class="o">/</span><span class="n">D</span><span class="p">)</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">rad</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">mas</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">xy2phasor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="kc">None</span><span class="p">,:]</span><span class="o">-</span><span class="n">offset</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="kc">None</span><span class="p">,:]</span><span class="o">-</span><span class="n">offset</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">phasor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">r</span><span class="o">/</span><span class="n">r_0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">phasor</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">complex</span><span class="p">)</span>
    <span class="n">all_offsets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">lamb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">mytable</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;INDEX&quot;</span><span class="p">,</span> <span class="s2">&quot;offsets&quot;</span><span class="p">],</span>
                    <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="n">all_offsets</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">mytable</span><span class="p">,</span> <span class="n">xy2phasor</span></div>

<div class="viewcode-block" id="NI_FOV"><a class="viewcode-back" href="../../../nifits.io.html#nifits.io.oifits.NI_FOV">[docs]</a><span class="k">class</span> <span class="nc">NI_FOV</span><span class="p">(</span><span class="n">NI_EXTENSION</span><span class="p">):</span>
    <span class="vm">__doc__</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    The ``NI_FOV`` data containing information of the field of view (vigneting)</span>
<span class="s2">    function as a function of wavelength.</span>

<span class="s2">    This can be interpreted in different ways depending on the value of the</span>
<span class="s2">    header keyword ``FOV_MODE``.</span>

<span class="s2">    * ``diameter_gaussian_radial``   : A simple gaussian radial falloff function</span>
<span class="s2">      based on a size of :math:`\lambda/D` and a chromatic offset defined for each</span>
<span class="s2">      spectral bin. The ``simple_from_header()`` constructor can help create a simple</span>
<span class="s2">      extension with 0 offset.</span>
<span class="s2">    * More options will come.</span>
<span class="s2">    &quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">NI_EXTENSION</span><span class="o">.</span><span class="vm">__doc__</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;NI_FOV&quot;</span>
<div class="viewcode-block" id="NI_FOV.simple_from_header"><a class="viewcode-back" href="../../../nifits.io.html#nifits.io.oifits.NI_FOV.simple_from_header">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">simple_from_header</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lamb</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor for a simple ``NI_FOV`` object with chromatic gaussian profile and </span>
<span class="sd">        no offset.</span>

<span class="sd">        **Arguments:**</span>

<span class="sd">        * header    : (astropy.io.fits.Header) Header containing the required information</span>
<span class="sd">          such as ``FOV_TELDIAM`` and ``FOV_TELDIAM_UNIT`` which are used to create the</span>
<span class="sd">          gaussian profiles of radius :math:`\lambda/D`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">telescope_diameter_q</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="s2">&quot;FOV_TELDIAM&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s2">&quot;FOV_TELDIAM_UNIT&quot;</span><span class="p">])</span>
        <span class="n">telescope_diameter_m</span> <span class="o">=</span> <span class="n">telescope_diameter_q</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">m</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">mytable</span><span class="p">,</span> <span class="n">xh2phasor</span> <span class="o">=</span> <span class="n">create_basic_fov_data</span><span class="p">(</span><span class="n">telescope_diameter_m</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span>
                                    <span class="n">lamb</span><span class="o">=</span><span class="n">lamb</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">data_table</span><span class="o">=</span><span class="n">mytable</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">)</span></div>




<div class="viewcode-block" id="NI_FOV.get_fov_function"><a class="viewcode-back" href="../../../nifits.io.html#nifits.io.oifits.NI_FOV.get_fov_function">[docs]</a>    <span class="k">def</span> <span class="nf">get_fov_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lamb</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the function to get the chromatic phasor</span>
<span class="sd">        given by injection for a the index n of the time series</span>

<span class="sd">        **This method will move to the backend**</span>

<span class="sd">        **Arguments:**</span>

<span class="sd">        * ``lamb`` : ArrayLike the array of wavelength bins</span>
<span class="sd">        * ``n``    : int the index of the time series to compute for</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">&quot;FOV_MODE&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;diameter_gaussian_radial&quot;</span>
        <span class="n">D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span>
        <span class="n">r_0</span> <span class="o">=</span> <span class="p">(</span><span class="n">lamb</span><span class="o">/</span><span class="n">D</span><span class="p">)</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">rad</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">mas</span><span class="p">)</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_table</span><span class="p">[</span><span class="s2">&quot;offsets&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
        <span class="k">def</span> <span class="nf">xy2phasor</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Returns the phasor for a given position of the field of view</span>

<span class="sd">            **Arguments:**</span>

<span class="sd">            * ``alpha`` : Position in RA</span>
<span class="sd">            * ``beta``  : Position in Dec</span>

<span class="sd">            **Returns:** The complex phasor</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">alpha</span><span class="p">[</span><span class="kc">None</span><span class="p">,:]</span><span class="o">-</span><span class="n">offset</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">beta</span><span class="p">[</span><span class="kc">None</span><span class="p">,:]</span><span class="o">-</span><span class="n">offset</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">phasor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">r</span><span class="o">/</span><span class="n">r_0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">phasor</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">complex</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xy2phasor</span></div></div>








<span class="c1"># class NI_MOD(object):</span>
<span class="c1">#     &quot;&quot;&quot;Contains input modulation vector for the given observation. The format</span>
<span class="c1">#     is a complex phasor representing the alteration applied by the instrument</span>
<span class="c1">#     to the light at its inputs. Either an intended modulation, or an estimated</span>
<span class="c1">#     instrumental error. the dimenstions are (n_ch, n_in)</span>
<span class="c1">#     </span>
<span class="c1">#     The effects modeled in NI_MOD must cumulate with some that may be modeled</span>
<span class="c1">#     in NI_CATM. It is recommended to include in CATM the static effects and in</span>
<span class="c1">#     NI_MOD any affect that may vary throughout the observing run.&quot;&quot;&quot;</span>
<span class="c1">#     def __init__(self, app_index, target_id, time, mjd,</span>
<span class="c1">#                 int_time, mod_phas, app_xy, arrcol,</span>
<span class="c1">#                 fov_index):</span>
<span class="c1">#         self.app_index = app_index</span>
<span class="c1">#         self.target_id = target_id</span>
<span class="c1">#         self.time = time</span>
<span class="c1">#         self.mjd = mjd</span>
<span class="c1">#         self.int_time = int_time</span>
<span class="c1">#         self.app_xy = app_xy</span>
<span class="c1">#         self.arrcol = arrcol</span>
<span class="c1">#         self.fov_index = fov_index</span>
<span class="c1">#         self.mod_phas = mod_phas</span>


<span class="n">NIFITS_EXTENSIONS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;OI_ARRAY&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;OI_WAVELENGTH&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;NI_CATM&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;NI_FOV&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;NI_KMAT&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;NI_MOD&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;NI_OUT&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;NI_KOUT&quot;</span><span class="p">])</span>

<span class="n">NIFITS_KEYWORDS</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">STATIC_EXTENSIONS</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span>
                    <span class="kc">True</span><span class="p">,</span>
                    <span class="kc">True</span><span class="p">,</span>
                    <span class="kc">True</span><span class="p">,</span>
                    <span class="kc">False</span><span class="p">,</span>
                    <span class="kc">False</span><span class="p">,</span>
                    <span class="kc">False</span><span class="p">,</span>
                    <span class="kc">False</span><span class="p">]</span>

<div class="viewcode-block" id="getclass"><a class="viewcode-back" href="../../../nifits.io.html#nifits.io.oifits.getclass">[docs]</a><span class="k">def</span> <span class="nf">getclass</span><span class="p">(</span><span class="n">classname</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="vm">__name__</span><span class="p">],</span> <span class="n">classname</span><span class="p">)</span></div>

<div class="viewcode-block" id="nifits"><a class="viewcode-back" href="../../../nifits.io.html#nifits.io.oifits.nifits">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">nifits</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class representation of the nifits object.&quot;&quot;&quot;</span>
    <span class="n">header</span><span class="p">:</span> <span class="n">fits</span><span class="o">.</span><span class="n">Header</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ni_catm</span><span class="p">:</span> <span class="n">NI_CATM</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ni_fov</span><span class="p">:</span> <span class="n">NI_FOV</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ni_kmat</span><span class="p">:</span> <span class="n">NI_KMAT</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">oi_wavelength</span><span class="p">:</span> <span class="n">OI_WAVELENGTH</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">oi_target</span><span class="p">:</span> <span class="n">OI_TARGET</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ni_mod</span><span class="p">:</span> <span class="n">NI_MOD</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ni_iout</span><span class="p">:</span> <span class="n">NI_IOUT</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ni_kiout</span><span class="p">:</span> <span class="n">NI_KIOUT</span> <span class="o">=</span> <span class="kc">None</span>

    

<div class="viewcode-block" id="nifits.from_nifits"><a class="viewcode-back" href="../../../nifits.io.html#nifits.io.oifits.nifits.from_nifits">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_nifits</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create the nifits object from the HDU extension of an opened fits file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">hdulist</span><span class="o">.</span><span class="n">HDUList</span><span class="p">):</span>
            <span class="n">hdulist</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hdulist</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            
        <span class="n">obj_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="s2">&quot;PRIMARY&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>
        <span class="n">obj_dict</span><span class="p">[</span><span class="s2">&quot;header&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">header</span>
        <span class="k">for</span> <span class="n">anext</span> <span class="ow">in</span> <span class="n">NIFITS_EXTENSIONS</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">hdulist</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">(</span><span class="n">anext</span><span class="p">):</span>
                <span class="n">theclass</span> <span class="o">=</span> <span class="n">getclass</span><span class="p">(</span><span class="n">anext</span><span class="p">)</span>
                <span class="n">theobj</span> <span class="o">=</span> <span class="n">theclass</span><span class="o">.</span><span class="n">from_hdu</span><span class="p">(</span><span class="n">hdulist</span><span class="p">[</span><span class="n">anext</span><span class="p">])</span>
                <span class="n">obj_dict</span><span class="p">[</span><span class="n">anext</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">theobj</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing </span><span class="si">{</span><span class="n">anext</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Checking header&quot;</span><span class="p">,</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">Header</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;contains_header:&quot;</span><span class="p">,</span> <span class="n">obj_dict</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">(</span><span class="s2">&quot;header&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">obj_dict</span><span class="p">)</span></div>

<div class="viewcode-block" id="nifits.to_nifits"><a class="viewcode-back" href="../../../nifits.io.html#nifits.io.oifits.nifits.to_nifits">[docs]</a>    <span class="k">def</span> <span class="nf">to_nifits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                        <span class="n">static_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">dynamic_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">static_hash</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                        <span class="n">writefile</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                        <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the extension objects to a nifits file.</span>

<span class="sd">        **Arguments**: </span>

<span class="sd">        * `static_only` :  (bool) only save the extensions corresponding</span>
<span class="sd">          to static parameters of the model (NI_CATM and NI_FOV). </span>
<span class="sd">          Default: False</span>
<span class="sd">        * `dynamic` only : (bool) only save the dynamic extensions. If true,</span>
<span class="sd">          the hash of the static file should be passed as `static_hash`.</span>
<span class="sd">          Default: False</span>
<span class="sd">        * `static_hash` : (str) The hash of the static file.</span>
<span class="sd">          Default: &quot;&quot;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: Possibly, the static_hash should be a dictionary with</span>
        <span class="c1"># a hash for each extension</span>
        <span class="n">hdulist</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">HDUList</span><span class="p">()</span>
        <span class="n">hdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">PrimaryHDU</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">static_only</span><span class="p">:</span>
            <span class="n">extension_list</span> <span class="o">=</span> <span class="n">NIFITS_EXTENSIONS</span><span class="p">[</span><span class="n">STATIC_EXTENSIONS</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">dynamic_only</span><span class="p">:</span>
            <span class="n">extension_list</span> <span class="o">=</span> <span class="n">NIFITS_EXTENSIONS</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">STATIC_EXTENSIONS</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">extension_list</span> <span class="o">=</span> <span class="n">NIFITS_EXTENSIONS</span>
        <span class="n">hdulist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hdu</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">anext</span> <span class="ow">in</span> <span class="n">extension_list</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">anext</span><span class="p">,</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">anext</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">anext</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">anext</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">theobj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">anext</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                <span class="n">thehdu</span> <span class="o">=</span> <span class="n">theobj</span><span class="o">.</span><span class="n">to_hdu</span><span class="p">()</span>
                <span class="n">hdulist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thehdu</span><span class="p">)</span>
                <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="n">anext</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Included&quot;</span>
                <span class="c1"># TODO Possibly we need to do this differently:</span>
                <span class="c1"># TODO Maybe pass the header to the `to_hdu` method?</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="n">anext</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Not included&quot;</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Could not find the </span><span class="si">{</span><span class="n">anext</span><span class="si">}</span><span class="s2"> object&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">writefile</span><span class="p">:</span>
            <span class="n">hdulist</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">hdulist</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">hdulist</span></div></div>












</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, R. Laugier.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>